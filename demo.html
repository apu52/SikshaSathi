<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Image to Text (Gemini API)</title>
</head>
<body>
  <h2>Upload an Image to Extract Text (Gemini)</h2>
  <input type="file" accept="image/*" onchange="extractTextFromImageWithGemini(this.files[0])" />

  <script>
    async function extractTextFromImageWithGemini(file) {
      const GEMINI_API_KEY = "AIzaSyA3wIbJGWIc_5RlrtxfdwwN6lzF5xTZ-Vc"; // 🔐 Replace with your real key

      if (!file) {
        alert("Please select a file.");
        return;
      }

      try {
        const base64 = await convertToBase64(file);
        const mimeType = file.type;

        const response = await fetch(
          `https://generativelanguage.googleapis.com/v1/models/gemini-1.5-pro:generateContent?key=${GEMINI_API_KEY}`,
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              contents: [
                {
                  role: "user",
                  parts: [
                    { text: "Extract all readable text from this image." },
                    {
                      inline_data: {
                        mime_type: mimeType,
                        data: base64,
                      },
                    },
                  ],
                },
              ],
            }),
          }
        );

        const data = await response.json();
        const extractedText = data?.candidates?.[0]?.content?.parts?.[0]?.text;

        if (extractedText) {
          alert("Extracted Text:\n\n" + extractedText);
        } else {
          alert("No readable text found or something went wrong.");
        }
      } catch (error) {
        console.error("Error extracting text:", error);
        alert("Failed to extract text from the image.");
      }
    }

    function convertToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => {
          const result = reader.result.split(",")[1]; // remove data:image/...;base64,
          resolve(result);
        };
        reader.onerror = reject;
      });
    }
  </script>
</body>
</html>
